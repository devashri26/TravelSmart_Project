[supervisord]
nodaemon=true

; ---------------- MySQL ----------------
[program:mysql]
command=/usr/sbin/mysqld
autostart=true
autorestart=true
stdout_logfile=/var/log/mysql.out.log
stderr_logfile=/var/log/mysql.err.log
priority=1


; ---------------- Init DB (run once) ----------------
[program:initdb]
command=/bin/bash -c "/app/init-db.sh"
autostart=true
autorestart=false
startsecs=0
stdout_logfile=/var/log/initdb.out.log
stderr_logfile=/var/log/initdb.err.log
priority=2


; ---------------- Backend (8080) ----------------
[program:backend]
command=/bin/bash -c "until mysqladmin ping --silent; do echo '‚è≥ waiting for mysql...'; sleep 2; done; java -jar /app/app.jar"
autostart=true
autorestart=true
startsecs=5
stdout_logfile=/var/log/backend.out.log
stderr_logfile=/var/log/backend.err.log
priority=10


; ---------------- Frontend (5173) ----------------
[program:frontend]
directory=/app/frontend
command=npm run dev -- --host 0.0.0.0 --port 5173
autostart=true
autorestart=true
stdout_logfile=/var/log/frontend.out.log
stderr_logfile=/var/log/frontend.err.log
priority=20
; ---------------- END ----------------